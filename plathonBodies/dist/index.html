<!DOCTYPE html>
<html>
  <head>
    <title>DS5 :: PlathonBodies</title>
    <meta charset="utf-8" />
    <link rel="stylesheet" href="styles.css" />
  </head>
  <body>
    <form name="form name" action="https://cgsg.pml30.ru" method="get">
      <input
        id="cgsg"
        type="image"
        src="https://cgsg.pml30.ru/!inc/CGSG-Logo.svg"
        height="100px"
      />
    </form>
    <script type="text/javascript" src="control.js"></script>
    <div>
      <input id="pause" type="checkbox" onclick="setPause(this)" />Pause
      <span id="fps">FPS: 47.00</span>
      <input id="windowW" type="range" min="100" max="1920" step="10" />
      <span id="windowWText">1080</span>
      <input id="windowH" type="range" min="100" max="1080" step="10" />
      <span id="windowHText">1080</span>
    </div>
    <canvas
      id="dsCan"
      width="1200px"
      height="800px"
      onmousedown="mouseChange(event, true)"
      onmouseup="mouseChange(event, false)"
      onmouseout="mouseOut()"
      onmousewheel="camCtrl(event)"
      onmousemove="camCtrl(event)"
    ></canvas>
    <script type="text/javascript" src="mth.js"></script>
    <script type="text/javascript" src="mthvec2.js"></script>
    <script type="text/javascript" src="mthvec3.js"></script>
    <script type="text/javascript" src="mthmat4.js"></script>
    <script type="text/javascript" src="rnd.js"></script>
    <script type="text/javascript" src="buffer.js"></script>
    <script type="text/javascript" src="shd.js"></script>
    <script type="text/javascript" src="mtl.js"></script>
    <script type="text/javascript" src="timer.js"></script>
    <script type="text/javascript" src="plathon.js"></script>
    <script type="text/javascript">
      let dsRnd = new dsRender();
      let myTimer = new dsTimer();
    </script>

    <script type="text/javascript" src="mthcam.js"></script>
    <script type="text/javascript">
      window.addEventListener("load", () => {
        window.addEventListener("keydown", pause);

        ds_cam.setSize(window.gl.canvas.width, window.gl.canvas.height);
        ds_cam.camSet(vec3(5), vec3(2.5, 0, 0), vec3(0, 1, 0));

        let gold = dsRnd.mtl.add(
          new dsMtl(
            "Gold",
            vec3(0.24725, 0.1995, 0.0745),
            vec3(0.75164, 0.60648, 0.22648),
            vec3(0.628281, 0.555802, 0.366065),
            51.2,
            1,
            0
          )
        );

        let silver = dsRnd.mtl.add(
          new dsMtl(
            "Silver",
            vec3(0.19225),
            vec3(0.50754),
            vec3(0.508273),
            51.2,
            1,
            0
          )
        );

        let obsidian = dsRnd.mtl.add(
          new dsMtl(
            "Obsidian",
            vec3(0.05375, 0.05, 0.06625),
            vec3(0.18275, 0.17, 0.22525),
            vec3(0.332741, 0.328634, 0.346435),
            38.4,
            1,
            0
          )
        );

        let bronze = dsRnd.mtl.add(
          new dsMtl(
            "Bronze",
            vec3(0.2125, 0.1275, 0.054),
            vec3(0.714, 0.4284, 0.18144),
            vec3(0.393548, 0.271906, 0.166721),
            25.6,
            1,
            0
          )
        );

        let emerald = dsRnd.mtl.add(
          new dsMtl(
            "Emerald",
            vec3(0.0215, 0.1745, 0.0215),
            vec3(0.07568, 0.61424, 0.07568),
            vec3(0.633, 0.727811, 0.633),
            76.8,
            1,
            0
          )
        );

        let pr = createTetrahedron(matrIdentity());
        pr.mtlNo = gold;
        let pr1 = createHexahedron(matrIdentity());
        pr1.mtlNo = silver;
        let pr2 = createOctahedron(matrIdentity());
        pr2.mtlNo = obsidian;
        let pr3 = createDodecahedron(matrIdentity());
        pr3.mtlNo = bronze;
        let pr4 = createIcosahedron(matrIdentity());
        pr4.mtlNo = emerald;

        let prom = dsRnd.primLoad("bin/models/cow.obj");
        let pr5;
        prom.then((res) => {
          pr5 = res;
          let v = pr5.maxBB.sub(pr.minBB);
          let max = v.x > v.y ? v.x : v.y;
          max = max > v.z ? max : v.z;
          pr5.trans = matrScale(vec3(1 / max, 1 / max, 1 / max).mulNum(1.5));
        });

        const draw = () => {
          resize();
          myTimer.response();
          matr = matrRotateZ(myTimer.localTime * 100).mulMatr(
            matrRotateX(myTimer.localTime * 100)
          );
          // matr = matrIdentity();
          dsRnd.start();

          pr.draw(matr);
          matr1 = matrTranslate(vec3(0, 2, 0));
          pr.draw(matr1);

          if (pr5 !== undefined) {
            matr1 = matr.mulMatr(matrTranslate(vec3(-2, 0, 0)));
            pr5.draw(matr1);
            matr1 = matrTranslate(vec3(-2, 2, 0));
            pr5.draw(matr1);
          }

          matr1 = matr.mulMatr(matrTranslate(vec3(2, 0, 0)));
          pr1.draw(matr1);
          matr1 = matrTranslate(vec3(2, 2, 0));
          pr1.draw(matr1);

          matr1 = matr.mulMatr(matrTranslate(vec3(4, 0, 0)));
          pr2.draw(matr1);
          matr1 = matrTranslate(vec3(4, 2, 0));
          pr2.draw(matr1);

          matr1 = matr.mulMatr(matrTranslate(vec3(6, 0, 0)));
          pr3.draw(matr1);
          matr1 = matrTranslate(vec3(6, 2, 0));
          pr3.draw(matr1);

          matr1 = matr.mulMatr(matrTranslate(vec3(8, 0, 0)));
          pr4.draw(matr1);
          matr1 = matrTranslate(vec3(8, 2, 0));
          pr4.draw(matr1);

          window.requestAnimationFrame(draw);
        };

        draw();
      });
    </script>
  </body>
</html>
