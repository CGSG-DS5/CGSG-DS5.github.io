!function(p){"use strict";function M(t){return t*(Math.PI/180)}function l(t){return t*(180/Math.PI)}class s{constructor(i){if("object"==typeof i)if("object"==typeof i[0]){this.a=[];for(let s=0;s<4;s++){var a=[];if(void 0!==i[s])for(let t=0;t<4;t++)a[t]=void 0===i[s][t]?0:i[s][t];else for(let t=0;t<4;t++)a[t]=0;this.a[s]=a}}else{this.a=[];for(let s=0;s<4;s++){var h=[];for(let t=0;t<4;t++)h[t]=void 0===i[4*s+t]?0:i[4*s+t];this.a[s]=h}}else{this.a=[];for(let s=0;s<4;s++){var e=[];for(let t=0;t<4;t++)e[t]=void 0===arguments[4*s+t]?0:arguments[4*s+t];this.a[s]=e}}}mulMatr=a=>{var h=y();for(let i=0;i<4;i++)for(let s=0;s<4;s++)for(let t=0;t<4;t++)h.a[i][s]+=this.a[i][t]*a.a[t][s];return h};transpose=()=>{var i=y();for(let s=0;s<4;s++)for(let t=0;t<4;t++)i.a[s][t]=this.a[t][s];return i};determ=()=>this.a[0][0]*i(this.a[1][1],this.a[1][2],this.a[1][3],this.a[2][1],this.a[2][2],this.a[2][3],this.a[3][1],this.a[3][2],this.a[3][3])-this.a[0][1]*i(this.a[1][0],this.a[1][2],this.a[1][3],this.a[2][0],this.a[2][2],this.a[2][3],this.a[3][0],this.a[3][2],this.a[3][3])+this.a[0][2]*i(this.a[1][0],this.a[1][1],this.a[1][3],this.a[2][0],this.a[2][1],this.a[2][3],this.a[3][0],this.a[3][1],this.a[3][3])-this.a[0][3]*i(this.a[1][0],this.a[1][1],this.a[1][2],this.a[2][0],this.a[2][1],this.a[2][2],this.a[3][0],this.a[3][1],this.a[3][2]);inverse=()=>{var t,s=this.determ();return 0===s?v():((t=y()).a[0][0]=i(this.a[1][1],this.a[1][2],this.a[1][3],this.a[2][1],this.a[2][2],this.a[2][3],this.a[3][1],this.a[3][2],this.a[3][3])/s,t.a[1][0]=-i(this.a[1][0],this.a[1][2],this.a[1][3],this.a[2][0],this.a[2][2],this.a[2][3],this.a[3][0],this.a[3][2],this.a[3][3])/s,t.a[2][0]=i(this.a[1][0],this.a[1][1],this.a[1][3],this.a[2][0],this.a[2][1],this.a[2][3],this.a[3][0],this.a[3][1],this.a[3][3])/s,t.a[3][0]=-i(this.a[1][0],this.a[1][1],this.a[1][2],this.a[2][0],this.a[2][1],this.a[2][2],this.a[3][0],this.a[3][1],this.a[3][2])/s,t.a[0][1]=-i(this.a[0][1],this.a[0][2],this.a[0][3],this.a[2][1],this.a[2][2],this.a[2][3],this.a[3][1],this.a[3][2],this.a[3][3])/s,t.a[1][1]=+i(this.a[0][0],this.a[0][2],this.a[0][3],this.a[2][0],this.a[2][2],this.a[2][3],this.a[3][0],this.a[3][2],this.a[3][3])/s,t.a[2][1]=-i(this.a[0][0],this.a[0][1],this.a[0][3],this.a[2][0],this.a[2][1],this.a[2][3],this.a[3][0],this.a[3][1],this.a[3][3])/s,t.a[3][1]=+i(this.a[0][0],this.a[0][1],this.a[0][2],this.a[2][0],this.a[2][1],this.a[2][2],this.a[3][0],this.a[3][1],this.a[3][2])/s,t.a[0][2]=+i(this.a[0][1],this.a[0][2],this.a[0][3],this.a[1][1],this.a[1][2],this.a[1][3],this.a[3][1],this.a[3][2],this.a[3][3])/s,t.a[1][2]=-i(this.a[0][0],this.a[0][2],this.a[0][3],this.a[1][0],this.a[1][2],this.a[1][3],this.a[3][0],this.a[3][2],this.a[3][3])/s,t.a[2][2]=+i(this.a[0][0],this.a[0][1],this.a[0][3],this.a[1][0],this.a[1][1],this.a[1][3],this.a[3][0],this.a[3][1],this.a[3][3])/s,t.a[3][2]=-i(this.a[0][0],this.a[0][1],this.a[0][2],this.a[1][0],this.a[1][1],this.a[1][2],this.a[3][0],this.a[3][1],this.a[3][2])/s,t.a[0][3]=-i(this.a[0][1],this.a[0][2],this.a[0][3],this.a[1][1],this.a[1][2],this.a[1][3],this.a[2][1],this.a[2][2],this.a[2][3])/s,t.a[1][3]=+i(this.a[0][0],this.a[0][2],this.a[0][3],this.a[1][0],this.a[1][2],this.a[1][3],this.a[2][0],this.a[2][2],this.a[2][3])/s,t.a[2][3]=-i(this.a[0][0],this.a[0][1],this.a[0][3],this.a[1][0],this.a[1][1],this.a[1][3],this.a[2][0],this.a[2][1],this.a[2][3])/s,t.a[3][3]=+i(this.a[0][0],this.a[0][1],this.a[0][2],this.a[1][0],this.a[1][1],this.a[1][2],this.a[2][0],this.a[2][1],this.a[2][2])/s,t)}}function y(...t){return new s(...t)}function v(){return y([[1,0,0,0],[0,1,0,0],[0,0,1,0],[0,0,0,1]])}function i(t,s,i,a,h,e,r,n,l){return t*h*l+s*e*r+i*a*n-t*e*n-s*a*l-i*h*r}function x(t){return y([[1,0,0,0],[0,1,0,0],[0,0,1,0],[t.x,t.y,t.z,1]])}function T(t){return y([[t.x,0,0,0],[0,t.y,0,0],[0,0,t.z,0],[0,0,0,1]])}function z(t){t=M(t);return y([[1,0,0,0],[0,Math.cos(t),Math.sin(t),0],[0,-Math.sin(t),Math.cos(t),0],[0,0,0,1]])}class a{constructor(t,s,i){void 0===t?this.x=this.y=this.z=0:"object"==typeof t?3===t.length?(this.x=t[0],this.y=t[1],this.z=t[2]):(this.x=t.x,this.y=t.y,this.z=t.z):void 0===s||void 0===i?this.x=this.y=this.z=t:(this.x=t,this.y=s,this.z=i)}add=t=>b(this.x+t.x,this.y+t.y,this.z+t.z);sub=t=>b(this.x-t.x,this.y-t.y,this.z-t.z);mulNum=t=>b(this.x*t,this.y*t,this.z*t);divNum=t=>b(this.x/t,this.y/t,this.z/t);neg=()=>b(-this.x,-this.y,-this.z);dot=t=>this.x*t.x+this.y*t.y+this.z*t.z;cross=t=>b(this.y*t.z-t.y*this.z,t.x*this.z-this.x*t.z,this.x*t.y-t.x*this.y);len2=()=>this.dot(this,this);len=()=>{var t=this.len2();return 0===t||1===t?t:Math.sqrt(t)};norm=()=>{var t=this.len();return this.divNum(t)};mulMatr=t=>{var s=this.x*t.a[0][3]+this.y*t.a[1][3]+this.z*t.a[2][3]+t.a[3][3];return b((this.x*t.a[0][0]+this.y*t.a[1][0]+this.z*t.a[2][0]+t.a[3][0])/s,(this.x*t.a[0][1]+this.y*t.a[1][1]+this.z*t.a[2][1]+t.a[3][1])/s,(this.x*t.a[0][2]+this.y*t.a[1][2]+this.z*t.a[2][2]+t.a[3][2])/s)};vecTransform=t=>b(this.x*t.a[0][0]+this.y*t.a[1][0]+this.z*t.a[2][0],this.x*t.a[0][1]+this.y*t.a[1][1]+this.z*t.a[2][1],this.x*t.a[0][2]+this.y*t.a[1][2]+this.z*t.a[2][2]);pointTransform=t=>b(this.x*t.a[0][0]+this.y*t.a[1][0]+this.z*t.a[2][0]+t.a[3][0],this.x*t.a[0][1]+this.y*t.a[1][1]+this.z*t.a[2][1]+t.a[3][1],this.x*t.a[0][2]+this.y*t.a[1][2]+this.z*t.a[2][2]+t.a[3][2])}function b(...t){return new a(...t)}class t{constructor(t,s){this.id=window.gl.createBuffer(),this.type=t,window.gl.bindBuffer(t,this.id),window.gl.bufferData(t,s,window.gl.STATIC_DRAW)}update(t){window.gl.bindBuffer(this.type,this.id),window.gl.bufferSubData(this.type,0,new Float32Array(t),0)}apply(){window.gl.bindBuffer(this.type,this.id)}free(){window.gl.deleteBuffer(this.id),this.id=null,this.size=0}}class e extends t{constructor(t){super(window.gl.ARRAY_BUFFER,44*t.length),this.numOfVertices=t.length,window.gl.bufferData(window.gl.ARRAY_BUFFER,new Float32Array(t),window.gl.STATIC_DRAW)}update(t){window.gl.bindBuffer(window.gl.ARRAY_BUFFER,this.id),window.gl.bufferSubData(window.gl.ARRAY_BUFFER,0,new Float32Array(t),0)}free(){super.free(),this.numOfVertices=0}}class r extends t{constructor(t){super(window.gl.ELEMENT_ARRAY_BUFFER,2*t.length),this.numOfIndices=t.length,window.gl.bufferData(window.gl.ELEMENT_ARRAY_BUFFER,new Uint32Array(t),window.gl.STATIC_DRAW)}update(t){window.gl.bindBuffer(window.gl.ELEMENT_ARRAY_BUFFER,this.id),window.gl.bufferSubData(window.gl.ELEMENT_ARRAY_BUFFER,0,new Uint32Array(t),0)}free(){super.free(),this.numOfIndices=0}}class n extends t{constructor(t,s,i){super(window.gl.UNIFORM_BUFFER,s),window.gl.bufferData(window.gl.UNIFORM_BUFFER,s,window.gl.STATIC_DRAW),this.name=t,this.bind=i}update(t){window.gl.bindBuffer(window.gl.UNIFORM_BUFFER,this.id),window.gl.bufferSubData(window.gl.UNIFORM_BUFFER,0,new Float32Array(t),0)}apply(t){var s=window.gl.getUniformBlockIndex(t,this.name);-1!==s&&(window.gl.uniformBlockBinding(t,s,this.bind),window.gl.bindBufferBase(window.gl.UNIFORM_BUFFER,this.bind,this.id))}free(){super.free()}}function o(t){return[t.loc.x,t.loc.y,t.loc.z,0,t.up.x,t.up.y,t.up.z,0,t.right.x,t.right.y,t.right.z,0,t.at.x,t.at.y,t.at.z,0]}class _{constructor(){this.setDefault();var t=o(this);this.ubo=new n("CamUBO",4*t.length,2),this.ubo.update(t)}setDefault=()=>{this.loc=b(1),this.at=b(0),this.dir=b(0,0,-1),this.up=b(0,1,0),this.right=b(1,0,0),this.projDist=.1,this.projSize=.1,this.projFarClip=300,this.frameW=this.frameH=30,this.camSet(this.loc,this.at,this.up),this.setProj(this.projSize,this.projDist,this.projFarClip)};camSet=(t,s,i)=>{var a,h,e;this.matrView=(a=t,i=i,h=(h=s).sub(a).norm(),e=(i=h.cross(i).norm()).cross(h),y([[i.x,e.x,-h.x,0],[i.y,e.y,-h.y,0],[i.z,e.z,-h.z,0],[-a.dot(i),-a.dot(e),a.dot(h),1]])),this.loc=t,this.at=s,this.dir=b(-this.matrView.a[0][2],-this.matrView.a[1][2],-this.matrView.a[2][2]),this.up=b(this.matrView.a[0][1],this.matrView.a[1][1],this.matrView.a[2][1]),this.right=b(this.matrView.a[0][0],this.matrView.a[1][0],this.matrView.a[2][0]),void 0!==this.ubo&&this.ubo.update(o(this)),void 0!==this.matrProj&&(this.matrVP=this.matrView.mulMatr(this.matrProj))};setProj=(t,s,i)=>{let a,h;var e,r,n;a=h=t,this.projDist=s,this.projSize=t,this.projFarClip=i,this.frameW>this.frameH?a*=this.frameW/this.frameH:h*=this.frameH/this.frameW,this.matrProj=(s=-a/2,t=a/2,i=-h/2,e=h/2,r=this.projDist,n=this.projFarClip,y([[2*r/(t-s),0,0,0],[0,2*r/(e-i),0,0],[(t+s)/(t-s),(e+i)/(e-i),(n+r)/(r-n),-1],[0,0,2*r*n/(r-n),0]])),this.matrVP=this.matrView.mulMatr(this.matrProj),void 0!==this.ubo&&this.ubo.update(o(this))};setSize=(t,s)=>{this.frameW=t,this.frameH=s,this.setProj(this.projSize,this.projDist,this.projFarClip)}}class h{constructor(t,s){this.x=t,this.y=void 0===s?t:s}}function m(...t){return new h(...t)}class d{constructor(t,s){this.progId=s,this.name=t}}function u(r){return this.load=i=>{const a=[["vert",r.VERTEX_SHADER],["frag",r.FRAGMENT_SHADER]];var t=[];for(let s=0;s<a.length;s++){var h="../bin/shaders/"+i+"/"+a[s][0]+".glsl";t[s]=fetch(h).then(t=>t.text()).then(t=>{a[s][2]=r.createShader(a[s][1]),r.shaderSource(a[s][2],t),r.compileShader(a[s][2]),r.getShaderParameter(a[s][2],r.COMPILE_STATUS)||(t=r.getShaderInfoLog(a[s][2]),console.log(t))})}const e=this.shaderSize;this.shaders[e]=new d(i,void 0),Promise.all(t).then(()=>{var t,s=r.createProgram();for(let t=0;t<a.length;t++)r.attachShader(s,a[t][2]);r.linkProgram(s),r.getProgramParameter(s,r.LINK_STATUS)||(t=r.getProgramInfoLog(s),console.log(t)),this.shaders[e]=new d(i,s)})},this.add=s=>{for(let t=0;t<this.shaderSize;t++)if(this.shaders[t].name===s)return t;return this.load(s),this.shaderSize++},this.shdGet=t=>t<0||t>=this.shaderSize?this.shaders[0]:this.shaders[t],this.shaderSize=0,this.shaders=[],this.add("default"),this}class q{constructor(t,s,i,a,h,e,r){this.name=t,this.ka=s,this.kd=i,this.ks=a,this.ph=h,this.trans=e,this.shdNo=r;t=[this.ka.x,this.ka.y,this.ka.z,this.ph,this.kd.x,this.kd.y,this.kd.z,this.trans,this.ks.x,this.ks.y,this.ks.z,0];this.uboBuf=new n("MtlUBO",4*t.length,1),this.uboBuf.update(t)}free(){this.uboBuf.free()}}function w(t){return this.getDef=()=>new q("Default",b(.1),b(.9),b(.3),30,1,0),this.add=s=>{for(let t=0;t<this.mtlSize;t++)if(s.name===this.mtls[t])return t;return this.mtls[this.mtlSize]=s,this.mtlSize++},this.get=t=>t<0||t>=this.mtlSize?this.mtls[0]:this.mtls[t],this.apply=t=>{var t=this.get(t),s=P.shd.shdGet(t.shdNo).progId;return void 0===s?0:(window.gl.useProgram(s),t.uboBuf.apply(s),s)},this.free=()=>{for(let t=0;t<this.mtlSize;t++)this.mtls[t].free()},this.mtlSize=0,this.mtls=[],this.add(this.getDef()),this}function S(s,i){for(let t=0;t<s.length;t++)s[t].n=b(0);if(null!==i)for(let t=0;t+2<i.length;t+=3){var a=s[i[t+1]].p.sub(s[i[t]].p).cross(s[i[t+2]].p.sub(s[i[t]].p)).norm();s[i[t]].n=s[i[t]].n.add(a).norm(),s[i[t+1]].n=s[i[t+1]].n.add(a).norm(),s[i[t+2]].n=s[i[t+2]].n.add(a).norm()}else for(let t=0;t+2<s.length;t+=3){var h=s[t+1].p.sub(s[t].p).cross(s[t+2].p.sub(s[t].p)).norm();s[t].n=s[t].n.add(h).norm(),s[t+1].n=s[t+1].n.add(h).norm(),s[t+2].n=s[t+2].n.add(h).norm()}}class c{constructor(t,s,i,a){void 0===t?(this.p=b(0),this.t=m(0),this.n=b(0),this.c=b(0)):"object"==typeof t&&void 0===s?(this.p=t.p,this.t=t.t,this.n=t.n,this.c=t.c):(this.p=t,this.t=s,this.n=i,this.c=a)}}function g(...t){return new c(...t)}function f(s,i){for(let t=0;t<16;t++)s.push(i.a[(t-t%4)/4][t%4])}class E{constructor(t,s,i){var a,h;this.vBuf=this.vA=this.iBuf=0,null!==s&&(a=window.gl.createVertexArray(),window.gl.bindVertexArray(a),h=function(s){var i=[];for(let t=0;t<s.length;t++)i.push(s[t].p.x),i.push(s[t].p.y),i.push(s[t].p.z),i.push(s[t].t.x),i.push(s[t].t.y),i.push(s[t].n.x),i.push(s[t].n.y),i.push(s[t].n.z),i.push(s[t].c.x),i.push(s[t].c.y),i.push(s[t].c.z);return i}(s),this.vBuf=new e(h),this.vA=a),null!==i?(h=window.gl.createBuffer(),window.gl.bindBuffer(window.gl.ELEMENT_ARRAY_BUFFER,h),window.gl.bufferData(window.gl.ELEMENT_ARRAY_BUFFER,2*i.length,window.gl.STATIC_DRAW),window.gl.bufferData(window.gl.ELEMENT_ARRAY_BUFFER,new Uint32Array(i),window.gl.STATIC_DRAW),this.iBuf=new r(i),this.numOfElements=i.length):this.numOfElements=s.length,this.trans=v(),this.type=t,this.mtlNo=0,[this.minBB,this.maxBB]=function(s){var i=b(s[0].p),a=b(s[0].p);for(let t=1;t<s.length;t++)s[t].p.x<i.x?i.x=s[t].p.x:s[t].p.x>a.x&&(a.x=s[t].p.x),s[t].p.y<i.y?i.y=s[t].p.y:s[t].p.y>a.y&&(a.y=s[t].p.y),s[t].p.z<i.z?i.z=s[t].p.z:s[t].p.z>a.z&&(a.z=s[t].p.z);return[i,a]}(s)}free=()=>{this.vBuf.free(),this.iBuf.free()};draw=t=>{var s,t=this.trans.mulMatr(t),i=t.inverse().transpose(),a=t.mulMatr(p.ds_cam.matrVP),h=P.mtl.apply(this.mtlNo);0!==h&&(f(s=[],t),f(s,i),f(s,a),P.matrixUBO.update(s),P.matrixUBO.apply(h),p.ds_cam.ubo.apply(h),-1!==(t=window.gl.getUniformLocation(h,"Time"))&&window.gl.uniform1f(t,D.localTime),-1!==(t=window.gl.getAttribLocation(h,"InPos"))&&(window.gl.vertexAttribPointer(t,3,window.gl.FLOAT,!1,44,0),window.gl.enableVertexAttribArray(t)),-1!==(t=window.gl.getAttribLocation(h,"InNormal"))&&(window.gl.vertexAttribPointer(t,3,window.gl.FLOAT,!1,44,20),window.gl.enableVertexAttribArray(t)),window.gl.bindVertexArray(this.vA),this.vBuf.apply(),0===this.iBuf?window.gl.drawArrays(this.type,0,this.numOfElements):(this.iBuf.apply(),window.gl.drawElements(this.type,this.numOfElements,window.gl.UNSIGNED_INT,0)))}}function B(s,i){var a=[];if(null!==i)for(let t=0;t<i.length;t++)a[t]=g(s[i[t]],m(0),b(0),b(0));else for(let t=0;t<s.length;t++)a[t]=g(s[t],m(0),b(0),b(0));return a}let F=!1,A=!1;function R(t,s){t.preventDefault(),0===t.button?F=s:2===t.button&&(A=s)}function I(){F=A=!1}function N(t){switch(t.keyCode){case 80:D.isPause=!D.isPause,document.getElementById("pause").checked=D.isPause;break;case 82:p.ds_cam.camSet(b(5),b(2.5,0,0),b(0,1,0))}}function U(a){if(a.ctrlKey&&void 0!==p.ds_cam){let i=p.ds_cam.at.sub(p.ds_cam.loc).len();var h=(p.ds_cam.loc.y-p.ds_cam.at.y)/i,e=Math.sqrt(1-h*h),r=i*e,n=(p.ds_cam.loc.z-p.ds_cam.at.z)/r,r=(p.ds_cam.loc.x-p.ds_cam.at.x)/r;let t=l(Math.atan2(r,n)),s=l(Math.atan2(e,h));if(F&&(t-=D.globalDeltaTime*a.movementX*10,s-=D.globalDeltaTime*a.movementY*10),i+=D.globalDeltaTime*(void 0===a.deltaY?0:a.deltaY)/20*i,s<.1?s=.1:178.9<s&&(s=178.9),i<.1&&(i=.1),A){let t,s;s=t=p.ds_cam.projSize,window.gl.canvas.width>window.gl.canvas.height?t*=window.gl.canvas.width/window.gl.canvas.height:t*=window.gl.canvas.height/window.gl.canvas.width;r=-(a.movementX*t/window.gl.canvas.width*i)/p.ds_cam.projDist,n=a.movementY*s/window.gl.canvas.height*i/p.ds_cam.projDist,e=p.ds_cam.right.mulNum(r).add(p.ds_cam.up.mulNum(n));p.ds_cam.at=p.ds_cam.at.add(e),p.ds_cam.loc=p.ds_cam.loc.add(e)}p.ds_cam.camSet(b(0,i,0).pointTransform(z(s).mulMatr((h=M(h=t),y([[Math.cos(h),0,-Math.sin(h),0],[0,1,0,0],[Math.sin(h),0,Math.cos(h),0],[0,0,0,1]]))).mulMatr(x(p.ds_cam.at))),p.ds_cam.at,b(0,1,0)),a.preventDefault()}}function j(t){D.isPause=t.checked}p.ds_cam=void 0;let P=new function(){return this.can=document.getElementById("dsCan"),this.gl=this.can.getContext("webgl2"),Object.defineProperty(window,"gl",{get:()=>(null!=this._gl&&null!=this._gl||(this.canvas=document.getElementById("dsCan"),this._gl=this.canvas.getContext("webgl2")),this._gl),set:t=>{this._gl=t}}),this.shd=new u(this.gl),this.mtl=new w(this.gl),this.matrixUBO=new n("MatrixUBO",192,0),this.gl.clearColor(.28,.47,.8,1),this.gl.enable(this.gl.DEPTH_TEST),this.start=()=>{this.gl.clear(this.gl.COLOR_BUFFER_BIT),this.gl.clear(this.gl.DEPTH_BUFFER_BIT),this.gl.enable(this.gl.DEPTH_TEST)},this.close=()=>{this.mtl.free()},this.primLoad=s=>new Promise((r,t)=>{let n=[],l=[],o,d;fetch(s).then(t=>t.text()).then(t=>{var s=t.split("\n");for(let t=0;t<s.length;t++)"v"===s[t].split(" ")[0]&&o++;for(let t=0;t<s.length;t++){var h=s[t].split(" ");if("v"===h[0]){var i=parseFloat(h[1]),a=parseFloat(h[2]),e=parseFloat(h[3]);n.push(g(b(i,a,e),m(0),b(0),b(0)))}else if("f"==h[0]){let s=0,i=0,a=0;for(let t=1;t<h.length;t++)(d=parseInt(h[t]))<0?d+=o:d--,0===s?i=d:a=(1===s||(l.push(i),l.push(a),l.push(d)),d),s++}}S(n,l),r(new E(gl.TRIANGLES,n,l))})}),this},D=new function(){const i=()=>{var t=new Date;return t.getMilliseconds()/1e3+t.getSeconds()+60*t.getMinutes()};return this.response=(t=null)=>{var s=i();this.globalTime=s,this.globalDeltaTime=s-this.oldTime,this.isPause?(this.localDeltaTime=0,this.pauseTime+=s-this.oldTime):(this.localDeltaTime=this.globalDeltaTime,this.localTime=s-this.pauseTime-this.startTime),this.frameCounter++,3<s-this.oldTimeFPS&&(this.FPS=this.frameCounter/(s-this.oldTimeFPS),this.oldTimeFPS=s,this.frameCounter=0,null!=t)&&(document.getElementById(t).innerHTML=this.getFPS()),this.oldTime=s,document.getElementById("fps").innerHTML="FPS:"+this.getFPS()},this.getFPS=()=>this.FPS.toFixed(3),this.globalTime=this.localTime=i(),this.globalDeltaTime=this.localDeltaTime=0,this.startTime=this.oldTime=this.oldTimeFPS=this.globalTime,this.frameCounter=0,this.isPause=!1,this.FPS=30,this.pauseTime=0,this};window.addEventListener("load",()=>{var t,s,i,a=sessionStorage.getItem("camera"),h=(a?(a=JSON.parse(a),p.ds_cam=new _,h=b(a.loc),e=b(a.at),r=a.up,p.ds_cam.camSet(h,e,r),p.ds_cam.setProj(a.projSize,a.projDist,a.projFarClip),p.ds_cam.setSize(a.frameW,a.frameH)):(p.ds_cam=new _,p.ds_cam.setSize(window.gl.canvas.width,window.gl.canvas.height),p.ds_cam.camSet(b(5),b(2.5,0,0),b(0,1,0))),window.addEventListener("keydown",N),mouseOutCan=I,mouseChangeCan=R,setPauseCheckbox=j,camCtrlCan=U,P.mtl.add(new q("Gold",b(.24725,.1995,.0745),b(.75164,.60648,.22648),b(.628281,.555802,.366065),51.2,1,0))),e=P.mtl.add(new q("Silver",b(.19225),b(.50754),b(.508273),51.2,1,0)),r=P.mtl.add(new q("Obsidian",b(.05375,.05,.06625),b(.18275,.17,.22525),b(.332741,.328634,.346435),38.4,1,0)),a=P.mtl.add(new q("Bronze",b(.2125,.1275,.054),b(.714,.4284,.18144),b(.393548,.271906,.166721),25.6,1,0)),n=P.mtl.add(new q("Emerald",b(.0215,.1745,.0215),b(.07568,.61424,.07568),b(.633,.727811,.633),76.8,1,0));i=v(),t=Math.sqrt(2),s=Math.sqrt(6),S(s=B([b(0,1,0),b(-t/3,-1/3,-s/3),b(-t/3,-1/3,s/3),b(2*t/3,-1/3,0)],[0,1,2,0,2,3,0,3,1,1,2,3]),null),(t=new E(window.gl.TRIANGLES,s,null)).trans=i;let l=t,o=(l.mtlNo=h,s=v(),S(i=B([b(-(i=1/Math.sqrt(3)),i,-i),b(i,i,-i),b(i,-i,-i),b(-i,-i,-i),b(-i,i,i),b(i,i,i),b(i,-i,i),b(-i,-i,i)],[0,1,2,0,2,3,2,1,5,2,5,6,3,2,6,3,6,7,0,3,7,0,7,4,1,0,4,1,4,5,6,5,4,6,4,7]),null),(i=new E(window.gl.TRIANGLES,i,null)).trans=s,i),d=(o.mtlNo=e,t=v(),S(h=B([b(-1,0,0),b(0,0,1),b(1,0,0),b(0,0,-1),b(0,1,0),b(0,-1,0)],[0,1,4,1,2,4,2,3,4,3,0,4,0,1,5,1,2,5,2,3,5,3,0,5]),null),(h=new E(window.gl.TRIANGLES,h,null)).trans=t,h),m=(d.mtlNo=r,function(t){var s=[b(0,-1,0),b(0,1,0),b(-2/Math.sqrt(5),-1/Math.sqrt(5),0),b(2/Math.sqrt(5),1/Math.sqrt(5),0),b(.5+.5/Math.sqrt(5),-1/Math.sqrt(5),-Math.sqrt(.1*(5-Math.sqrt(5)))),b(.5+.5/Math.sqrt(5),-1/Math.sqrt(5),Math.sqrt(.1*(5-Math.sqrt(5)))),b(-.1*(5+Math.sqrt(5)),1/Math.sqrt(5),-Math.sqrt(.1*(5-Math.sqrt(5)))),b(-.1*(5+Math.sqrt(5)),1/Math.sqrt(5),Math.sqrt(.1*(5-Math.sqrt(5)))),b(.1*Math.sqrt(5)-.5,-1/Math.sqrt(5),-Math.sqrt(.1*(5+Math.sqrt(5)))),b(.1*Math.sqrt(5)-.5,-1/Math.sqrt(5),Math.sqrt(.1*(5+Math.sqrt(5)))),b(.5-.1*Math.sqrt(5),1/Math.sqrt(5),-Math.sqrt(.1*(5+Math.sqrt(5)))),b(.5-.1*Math.sqrt(5),1/Math.sqrt(5),Math.sqrt(.1*(5+Math.sqrt(5))))];let i=[0,8,2,0,2,9,0,9,5,0,5,4,0,4,8,1,3,10,1,10,6,1,6,7,1,7,11,1,11,3,3,4,5,10,4,8,6,8,2,7,2,9,11,9,5,4,10,3,8,10,6,2,6,7,9,7,11,5,11,3];var a=[];for(let t=0;t+2<i.length;t+=3){var h=b(s[i[t]].x+s[i[t+1]].x+s[i[t+2]].x,s[i[t]].y+s[i[t+1]].y+s[i[t+2]].y,s[i[t]].z+s[i[t+1]].z+s[i[t+2]].z).divNum(3);a.push(h)}var e=T(b(1/a[0].len()));for(let t=0;t<a.length;t++)a[t]=a[t].pointTransform(e);var r=B(a,i=[0,1,2,0,2,3,0,3,4,1,2,13,2,13,14,13,14,18,0,1,12,1,12,13,12,13,17,4,0,11,0,11,12,11,12,16,3,4,10,4,10,11,10,11,15,2,3,14,3,14,10,14,10,19,19,14,18,18,19,9,8,18,9,18,13,17,17,18,8,7,17,8,17,12,16,16,17,7,6,16,7,16,11,15,15,16,6,5,15,6,15,10,19,19,15,5,9,19,5,5,6,7,5,7,8,5,8,9]);return S(r,null),(r=new E(window.gl.TRIANGLES,r,null)).trans=t,r}(v())),u=(m.mtlNo=a,s=v(),S(i=B([b(0,-1,0),b(0,1,0),b(-2/Math.sqrt(5),-1/Math.sqrt(5),0),b(2/Math.sqrt(5),1/Math.sqrt(5),0),b(.5+.5/Math.sqrt(5),-1/Math.sqrt(5),-Math.sqrt(.1*(5-Math.sqrt(5)))),b(.5+.5/Math.sqrt(5),-1/Math.sqrt(5),Math.sqrt(.1*(5-Math.sqrt(5)))),b(-.1*(5+Math.sqrt(5)),1/Math.sqrt(5),-Math.sqrt(.1*(5-Math.sqrt(5)))),b(-.1*(5+Math.sqrt(5)),1/Math.sqrt(5),Math.sqrt(.1*(5-Math.sqrt(5)))),b(.1*Math.sqrt(5)-.5,-1/Math.sqrt(5),-Math.sqrt(.1*(5+Math.sqrt(5)))),b(.1*Math.sqrt(5)-.5,-1/Math.sqrt(5),Math.sqrt(.1*(5+Math.sqrt(5)))),b(.5-.1*Math.sqrt(5),1/Math.sqrt(5),-Math.sqrt(.1*(5+Math.sqrt(5)))),b(.5-.1*Math.sqrt(5),1/Math.sqrt(5),Math.sqrt(.1*(5+Math.sqrt(5))))],[0,8,2,0,2,9,0,9,5,0,5,4,0,4,8,1,3,10,1,10,6,1,6,7,1,7,11,1,11,3,3,4,5,10,4,8,6,8,2,7,2,9,11,9,5,4,10,3,8,10,6,2,6,7,9,7,11,5,11,3]),null),(i=new E(window.gl.TRIANGLES,i,null)).trans=s,i);u.mtlNo=n;e=P.primLoad("../bin/models/cow.obj");let w;e.then(t=>{(w=t).mtlNo=P.mtl.add(new q("Cow material",P.mtl.mtls[0].ka,P.mtl.mtls[0].kd,P.mtl.mtls[0].ks,P.mtl.mtls[0].ph,1,P.shd.add("cow")));var t=w.maxBB.sub(l.minBB),s=(s=t.x>t.y?t.x:t.y)>t.z?s:t.z;w.trans=T(b(1/s,1/s,1/s).mulNum(1.5))});let c,g;const f=()=>{var t,s;s=document.getElementById("windowW"),t=document.getElementById("windowWText"),window.gl.canvas.width=parseInt(s.value),t.innerHTML="FrameW:"+s.value,t=document.getElementById("windowH"),s=document.getElementById("windowHText"),window.gl.canvas.height=parseInt(t.value),s.innerHTML="FrameH:"+t.value,p.ds_cam.setSize(window.gl.canvas.width,window.gl.canvas.height),window.gl.viewport(0,0,window.gl.canvas.width,window.gl.canvas.height),D.response(),c=(s=M(s=100*D.localTime),y([[Math.cos(s),Math.sin(s),0,0],[-Math.sin(s),Math.cos(s),0,0],[0,0,1,0],[0,0,0,1]]).mulMatr(z(100*D.localTime))),P.start(),l.draw(c),g=x(b(0,2,0)),l.draw(g),void 0!==w&&(g=c.mulMatr(x(b(-2,0,0))),w.draw(g),g=x(b(-2,2,0)),w.draw(g)),g=c.mulMatr(x(b(2,0,0))),o.draw(g),g=x(b(2,2,0)),o.draw(g),g=c.mulMatr(x(b(4,0,0))),d.draw(g),g=x(b(4,2,0)),d.draw(g),g=c.mulMatr(x(b(6,0,0))),m.draw(g),g=x(b(6,2,0)),m.draw(g),g=c.mulMatr(x(b(8,0,0))),u.draw(g),g=x(b(8,2,0)),u.draw(g),sessionStorage.setItem("camera",JSON.stringify(p.ds_cam)),window.requestAnimationFrame(f)};f()}),p.dsRnd=P,p.myTimer=D}({});
